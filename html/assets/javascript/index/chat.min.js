(function(t){"use strict";const a=({methodName:a,data:n})=>new Promise((e,s)=>{t.PostComponents(a,n,t=>{e(t)})});class n{constructor(){this.globalType=$('<div class="msg_block_getting"></div>'),this.UserData=null}async scrollBlock(){$(".chat_block_chat_body_msgs").animate({scrollTop:$(".chat_block_chat_body_msgs").prop("scrollHeight")},"fast")}async pushMsgOfUser(n){function e(t){return t.toString().padStart(2,"0")}function s(t){let a=Math.floor(t/1e3),n=Math.floor(a/60),s=Math.floor(n/60);return a%=60,n%=60,s%=24,`${e(s)}:${e(n)}:${e(a)}`}var _=s(Number((new Date).getTime().toString())),i=$(`\n                <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                    <div class="chat_block_chat_body_msgs_line_header">\n                        <span>Вы</span>\n                        <div class="chat_block_chat_body_msgs_line_header_time">\n                            <bb>${_}</bb>\n                        </div>\n                    </div>\n                    <div class="chat_block_chat_body_msgs_line_my">\n                        <span>${n}</span>\n                    </div>\n                </div>\n            `);$(".chat_block_chat_body_msgs").append(i),await a({methodName:"msgUP",data:{user:t.allData._id,type:t.allData.User.type,id:_GET("id"),msg:n}}),this.scrollBlock(),$(".chat_block_chat_body_row_input input").val("")}async removeButtons(){"business"==t.allData.User.type?$(".chat_block_info_more_buttons").remove():$('.chat_block_info_more_buttons_line[data="complaint"]').remove()}async removeButtonsAll(){$(".chat_block_info_more_buttons").remove()}async renderChat(){function n(t){return t.toString().padStart(2,"0")}function e(t){let a=Math.floor(t/1e3),e=Math.floor(a/60),s=Math.floor(e/60);return a%=60,e%=60,s%=24,`${n(s)}:${n(e)}:${n(a)}`}var s=this,_=null,i=null,o=null,c=null;_GET("owner")?(_=await a({methodName:"version2_owner_getChatsOfId",data:{user:t.allData._id}}),o="Техническая поддержка",c=""):(_=await a({methodName:"getChatsOfId",data:{user:t.allData._id,id:_GET("id")}}),i=_.photo,o=_.name,c=_.type);var l=$(`\n                <div class="chat_block">\n                    <div class="chat_block_chat">\n                        <div class="version2_default_bkg row_default"></div>\n                        <div class="chat_block_chat_header">\n                            <span>Чат</span>\n                        </div>\n                        <div class="chat_block_chat_body">\n                            <div class="chat_block_chat_body_row">\n\n                                <div class="chat_block_chat_body_msgs">\n\n                                </div>\n\n                                <div class="chat_block_chat_body_row_input">\n                                    <input type="text" placeholder="Напишите сообщение">\n                                    <span>\n                                        <i class="fas fa-paper-plane"></i>\n                                    </span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="chat_block_info">\n                        <div class="version2_default_bkg row_default"></div>\n                        <div class="info_active_block_photo">\n                            <img src="${i}" alt="">\n                        </div>\n                        <span>${o}</span>\n                        <p>${c}</p>\n\n                        <div class="chat_block_info_more_buttons">\n                            \n                        </div>\n                    </div>\n                </div>\n            `);if(l.find(".chat_block_chat").prepend($('\n                <div class="chatPageBehinedByMoreBlocks">\n                    <i class="fal fa-angle-left"></i>\n                    <bb>\n                        <bb_circule></bb_circule>\n                        <bb_circule></bb_circule>\n                        <bb_circule></bb_circule>\n                    </bb>\n                </div>\n            ').css({position:"absolute","z-index":"6",left:"10px",top:"10px"})),l.find(".chatPageBehinedByMoreBlocks i").click(function(){$(".chat_block").fadeOut("fast",function(){s.renderType(),$(this).remove()})}),l.find(".chatPageBehinedByMoreBlocks bb").click(function(){$(".chat_block").toggleClass("selected")}),l.find(".chat_block_chat_header bb").click(function(){$(".chat_block").toggleClass("selected")}),_GET("owner")){if(_.msgs)for(var d of _.msgs){h="";void 0!==d.time&&(h=e(Number(d.time.toString()))),"user"==d.type?l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>Вы</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${d.text}</span>\n                                    </div>\n                                </div>\n                            `):l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>Администрация</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${d.text}</span>\n                                    </div>\n                                </div>\n                            `)}l.find(".chat_block_chat_body_row_input span").click(async function(){var n=e(Number((new Date).getTime().toString())),_=$(`\n                        <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                            <div class="chat_block_chat_body_msgs_line_header">\n                                <span>Вы</span>\n                                <div class="chat_block_chat_body_msgs_line_header_time">\n                                    <bb>${n}</bb>\n                                </div>\n                            </div>\n                            <div class="chat_block_chat_body_msgs_line_my">\n                                <span>${$(".chat_block_chat_body_row_input input").val()}</span>\n                            </div>\n                        </div>\n                    `);$(".chat_block_chat_body_msgs").append(_),await a({methodName:"version2_owner_msgUP",data:{user:t.allData._id,id:_GET("id"),msg:$(".chat_block_chat_body_row_input input").val()}}),s.scrollBlock(),$(".chat_block_chat_body_row_input input").val("")}),$(".index_page_body_data").append(l)}else{if("not_correct"==_.Inv.status&&"money"==_.Inv.not_correct.dataType){var r={investor:function(){var n=$('\n                                    <div class="chat_block_info_more_buttons_line_row">\n                                        <div class="chat_block_info_more_buttons_line" data="complaint">\n                                            <span>Подать жалобу</span>\n                                        </div>\n                                        <div class="chat_block_info_more_buttons_line" data="cancel">\n                                            <span>Отменить и заполнить заного</span>\n                                        </div>\n                                    </div>\n                                ');return n.find('.chat_block_info_more_buttons_line[data="complaint"]').click(function(){SoloAlert.confirm({title:"Подтверждение",body:"Вы уверены, что хотите отправить жалобу?",theme:"dark",html:"",useTransparency:!0}).then(async t=>{t&&(await a({methodName:"not_correct_complaint",data:_GET("id")}),s.pushMsgOfUser("Инвестор подал жалобу по этому проекту, ожидайте решения модерации"),s.removeButtons(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}))})}),n.find('.chat_block_info_more_buttons_line[data="cancel"]').click(function(){SoloAlert.confirm({title:"Подтверждение",body:"Вы уверены, что хотите отменить инвестицию?",theme:"dark",html:"",useTransparency:!0}).then(async n=>{if(n){var e=await a({methodName:"not_correct_complaint_again",data:_GET("id")});s.pushMsgOfUser("Инвестиция была отменена инвестором"),s.removeButtonsAll(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}).then(function(){location.href=`https://investir.one/?user=${t.allData._id}&page=invester_data&InvRedacting=${e}`})}})}),n},business:function(){var t=$('\n                                    <div class="chat_block_info_more_buttons_line_row">\n                                        <div class="chat_block_info_more_buttons_line" data="accept_investing">\n                                            <span>Принять инвестицию</span>\n                                        </div>\n                                        <div class="chat_block_info_more_buttons_line" data="request_again">\n                                            <span>Оформить инвестицию повторно</span>\n                                        </div>\n                                        <div class="chat_block_info_more_buttons_line" data="complaint">\n                                            <span>Подать жалобу</span>\n                                        </div>\n                                    </div>\n                                ');return t.find('.chat_block_info_more_buttons_line[data="complaint"]').click(function(){SoloAlert.confirm({title:"Подтверждение",body:"Вы уверены, что хотите отправить жалобу?",theme:"dark",html:"",useTransparency:!0}).then(async t=>{t&&(await a({methodName:"not_correct_complaint",data:_GET("id")}),s.pushMsgOfUser("Бизнес подал жалобу по этому проекту, ожидайте решения модерации"),s.removeButtons(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}))})}),t.find('.chat_block_info_more_buttons_line[data="accept_investing"]').click(function(){SoloAlert.confirm({title:"Подтверждение",body:"Вы уверены, что хотите принять инвестицию?",theme:"dark",html:"",useTransparency:!0}).then(async t=>{t&&(await a({methodName:"version2_acceptInvOfComplaintBusinnes",data:_GET("id")}),s.pushMsgOfUser("Бизнес принял инвестицию"),s.removeButtonsAll(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}))})}),t.find('.chat_block_info_more_buttons_line[data="request_again"]').click(function(){SoloAlert.confirm({title:"Подтверждение",body:"Вы уверены, что хотите отправить запрос на оформление инвестиции повторно?",theme:"dark",html:"",useTransparency:!0}).then(async t=>{t&&(await a({methodName:"requestInvestingOfRemove",data:_GET("id")}),s.pushMsgOfUser("Бизнес отправил запрос на перезаполнение инвестиции"),s.removeButtonsAll(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}))})}),t}};l.find(".chat_block_info_more_buttons").append(r[t.allData.User.type]()),l.find(".chat_block_info_more_buttons").css("display","block")}if(l.find(".chat_block_chat_body_row_input span").click(async function(){var n=e(Number((new Date).getTime().toString())),_=$(`\n                        <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                            <div class="chat_block_chat_body_msgs_line_header">\n                                <span>Вы</span>\n                                <div class="chat_block_chat_body_msgs_line_header_time">\n                                    <bb>${n}</bb>\n                                </div>\n                            </div>\n                            <div class="chat_block_chat_body_msgs_line_my">\n                                <span>${$(".chat_block_chat_body_row_input input").val()}</span>\n                            </div>\n                        </div>\n                    `);$(".chat_block_chat_body_msgs").append(_),await a({methodName:"msgUP",data:{user:t.allData._id,type:t.allData.User.type,id:_GET("id"),msg:$(".chat_block_chat_body_row_input input").val()}}),s.scrollBlock(),$(".chat_block_chat_body_row_input input").val("")}),_.msgs)for(var d of _.msgs){var h="";void 0!==d.time&&(h=e(Number(d.time.toString()))),d.type==t.allData.User.type?l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>Вы</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${d.text}</span>\n                                    </div>\n                                </div>\n                            `):l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>${_.name}</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${d.text}</span>\n                                    </div>\n                                </div>\n                            `)}$(".index_page_body_data").append(l),void 0!==_.Inv.not_correct_complaint&&s.removeButtons(),"investor"==t.allData.User.type&&void 0!==_.Inv.request_remove&&SoloAlert.confirm({title:"Подтверждение",body:"Бизнес отпрасил запрос на закрытие и перезаполнение инвестиции",theme:"dark",html:"",useTransparency:!0}).then(async t=>{t?(await a({methodName:"not_correct_complaint_again",data:_GET("id")}),s.pushMsgOfUser("Инвестиция была отменена инвестором"),s.removeButtonsAll(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"})):(await a({methodName:"requestInvestingOfRemoveCLOSE",data:_GET("id")}),s.pushMsgOfUser("Предложение было отклонено инвестором"),s.removeButtonsAll(),SoloAlert.alert({title:"Успешно",body:"",icon:"success"}))})}imSocket.on("request_mail",function(a){if(_GET("id")&&_GET("id")==a.id.toString()){var n=a;n.type==t.allData.User.type?l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line chat_block_chat_body_msgs_line_left">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>Вы</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${n.text}</span>\n                                    </div>\n                                </div>\n                            `):l.find(".chat_block_chat_body_msgs").append(`\n                                <div class="chat_block_chat_body_msgs_line">\n                                    <div class="chat_block_chat_body_msgs_line_header">\n                                        <span>Вам</span>\n                                        <div class="chat_block_chat_body_msgs_line_header_time">\n                                            <bb>${h}</bb>\n                                        </div>\n                                    </div>\n                                    <div class="chat_block_chat_body_msgs_line_my">\n                                        <span>${n.text}</span>\n                                    </div>\n                                </div>\n                            `),s.scrollBlock()}}),s.scrollBlock()}async renderChatMoreBlock(t){var a=this;$(".msg_block_getting").fadeOut("fast",function(){for(var n of($(this).empty().append($('\n                    <div class="chatPageBehinedByMoreBlocks">\n                        <i class="fal fa-angle-left"></i>\n                    </div>\n                ').click(function(){$(".msg_block_getting").fadeOut("fast",function(){$(".msg_block_getting").empty(),a.renderType(),$(".msg_block_getting").fadeIn("fast")})})),t)){var e=null,s=!1,_=[];if(n.img&&(e="https://api.telegram.org/file/bot2062839693:AAE0hzj8SVXyexq29s5x7aRLC5x8O77c-pQ/"+n.img.file_path),void 0!==a.UserData.alerts_main)for(var i of a.UserData.alerts_main)"new_msg"==i.type&&_.push(i.idChat);if(_.length>0)for(var o of _)o.toString()==n.invId.toString()&&(s=!0);var c=$(`\n                        <div class="msg_block_getting_line" data="${n.invId}">\n                            <div class="version2_default_bkg row_default"></div>\n                            <div class="msg_block_getting_line_img">\n                                <div class="msg_block_getting_line_img_block">\n                                    <img src="${e}" alt="">\n                                </div>\n                            </div>\n                            <div class="msg_block_getting_line_text">\n                                <span>${n.name} ${n.Project._id}/${n.invDoc.number} от ${DateFormatted(n.invDoc.data.date.toString())} | ${n.invDoc.data.data.pay} ₽</span>\n                                <p>${n.msgBlock.msgs[n.msgBlock.msgs.length-1].text}</p>\n                            </div>\n                        </div>\n                    `);s&&c.append($('\n                            <div class="msg_block_getting_line_alertBlock"></div>\n                        ')),c.click(function(){location.href=`./?page=chats&id=${$(this).attr("data")}`}),$(this).append(c)}$(this).fadeIn("fast")})}async renderType(){var n=!0,e=window.allData.User.type,s=this,_=await a({methodName:"getChats",data:t.allData._id});this.UserData=_.User;var i=[];if(void 0!==_.User.alerts_main)for(var o of _.User.alerts_main)"new_msg"==o.type&&i.push(o.idChat);if("business"==e){if(void 0!==_.defaultChats.business)for(var c in _.defaultChats.business){var l=null,d=_.defaultChats.business[c][0],r=!1;if(i.length>0)for(var h of _.defaultChats.business[c])for(var b of i)b.toString()==h.invId.toString()&&(r=!0);d.img&&(l="https://api.telegram.org/file/bot2062839693:AAE0hzj8SVXyexq29s5x7aRLC5x8O77c-pQ/"+d.img.file_path);var m=$(`\n                            <div class="msg_block_getting_line" data="${d.invId}" data-id="${c}">\n                                <div class="version2_default_bkg row_default"></div>\n                                <div class="msg_block_getting_line_img">\n                                    <div class="msg_block_getting_line_img_block">\n                                        <img src="${l}" alt="">\n                                    </div>\n                                </div>\n                                <div class="msg_block_getting_line_text">\n                                    <span>${d.name}</span>\n                                    <p>${d.msgBlock.msgs[d.msgBlock.msgs.length-1].text}</p>\n                                </div>\n                            </div>\n                        `);r&&m.append($('\n                                <div class="msg_block_getting_line_alertBlock"></div>\n                            ')),_.defaultChats.business[c].length>0?(m.append(`\n                                <div class="msg_block_getting_line_moreInfo">\n                                    <span>+ ${_.defaultChats.business[c].length-1}</span>\n                                </div>\n                            `).addClass("msg_block_getting_line_Many").click(function(){s.renderChatMoreBlock(_.defaultChats.business[$(this).attr("data-id")])}),m.find(".msg_block_getting_line_text p").remove(),m.find(".msg_block_getting_line_text").css({display:"flex","align-items":"center"})):m.click(function(){location.href=`./?page=chats&id=${$(this).attr("data")}`}),n=!1,s.globalType.append(m)}}else if(void 0!==_.defaultChats.other)for(var c in _.defaultChats.other){l=null,d=_.defaultChats.other[c][0],r=!1;if(i.length>0)for(var h of _.defaultChats.other[c])for(var b of i)b.toString()==h.invId.toString()&&(r=!0);d.img&&(l="https://api.telegram.org/file/bot2062839693:AAE0hzj8SVXyexq29s5x7aRLC5x8O77c-pQ/"+d.img.file_path);m=$(`\n                            <div class="msg_block_getting_line" data="${d.invId}" data-id="${c}">\n                                <div class="version2_default_bkg row_default"></div>\n                                <div class="msg_block_getting_line_img">\n                                    <div class="msg_block_getting_line_img_block">\n                                        <img src="${l}" alt="">\n                                    </div>\n                                </div>\n                                <div class="msg_block_getting_line_text">\n                                    <span>${d.name}</span>\n                                    <p>${d.msgBlock.msgs[d.msgBlock.msgs.length-1].text}</p>\n                                </div>\n                            </div>\n                        `);r&&m.append($('\n                                <div class="msg_block_getting_line_alertBlock"></div>\n                            ')),_.defaultChats.other[c].length>0?(m.append(`\n                                <div class="msg_block_getting_line_moreInfo">\n                                    <span>+ ${_.defaultChats.other[c].length-1}</span>\n                                </div>\n                            `).addClass("msg_block_getting_line_Many").click(function(){s.renderChatMoreBlock(_.defaultChats.other[$(this).attr("data-id")])}),m.find(".msg_block_getting_line_text p").remove(),m.find(".msg_block_getting_line_text").css({display:"flex","align-items":"center"})):m.click(function(){location.href=`./?page=chats&id=${$(this).attr("data")}`}),n=!1,s.globalType.append(m)}n&&s.globalType.append('<span class="msg_block_errorPush">У вас пока нет чатов</span>'),$(".index_page_body_data").append(s.globalType)}async render(){var t=_GET("id"),a=_GET("auth_date"),n=_GET("owner");t?a?n?location.href="./?owner=true":this.renderType():this.renderChat():n?this.renderChat():this.renderType()}}var e={chat:n};if(t.Components)for(var s in e)t.Components[s]=e[s];else t.Components=e})(window);